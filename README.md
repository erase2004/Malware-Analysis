AMD:Android Malware Detector
===

It is used to check whether Android App is malicious. <br />
We first use simlarity funciton to examinate the App with previous Apps. <br />
If they are not quite similiar, then we perform taint analysis on it to check <br />
whether there is privacy data leak. <br />

#### Obtaining the software:
=======================

Just use git to clone the whole project file: <br />

<code>
git clone https://github.com/erase2004/Malware-Analysis.git
</code>

#### Prerequisites:
==============

To run the program correctly, making sure that you have installed following software or library. <br />

- gcc                 (the GNU Compiler Collection, our version is 4.7.2)
- jre                 (JAVA Runtime Environment, our version is 1.7.0\_09)
- Graphviz            (Graph visualization software, our version is 2.28.0-11)
- MySQL               (our version is 5.5.27-log)
- perl                (our version is 5.16.2)
- CPAN                (our version is 1.9800)
- CPAN Modules:
   - Archive::Zip    (our version is 1.30, http://search.cpan.org/~adamk/Archive-Zip-1.30/lib/Archive/Zip.pm)
   - Cwd             (our version is 3.39\_02, http://search.cpan.org/~smueller/PathTools-3.33/Cwd.pm)
   - DBI             (our version is 1.623, http://search.cpan.org/~timb/DBI-1.623/DBI.pm)
   - Digest::MD5     (our version is 2.52, http://search.cpan.org/~gaas/Digest-MD5-2.52/MD5.pm)
   - FileHandle      (our version is 2.02, http://search.cpan.org/~dom/perl-5.12.5/lib/FileHandle.pm)
   - File::Copy      (our version is 2.23, http://search.cpan.org/~dom/perl-5.12.5/lib/File/Copy.pm)
   - File::Path      (our version is 2.08\_1, http://search.cpan.org/~dland/File-Path-2.08/Path.pm)
   - Graph           (our version is 0.94, http://search.cpan.org/~jhi/Graph-0.94/lib/Graph.pod)
   - Graph::Writer   (our version is 2.03, http://search.cpan.org/~neilb/Graph-ReadWrite-2.03/lib/Graph/Writer.pm)
   - GraphViz        (our version is 2.14, http://search.cpan.org/~rsavage/GraphViz-2.14/lib/GraphViz.pm)
   - threads         (our version is 1.86, http://search.cpan.org/~jdhedden/threads-1.86/lib/threads.pm)
   - threads::shared (our version is 1.40, http://search.cpan.org/~jdhedden/threads-shared-1.42/lib/threads/shared.pm)
   - URI::Escape     (our version is 3.31, http://search.cpan.org/~gaas/URI-1.60/URI/Escape.pm)

After installing the prerequisites, You have to create following directory: <br />

```
<Project_dir>/log
<Project_dir>/files
<Project_dir>/files/BB
<Project_dir>/files/FH
<Project_dir>/files/REPORT
```

Also creating unique MySQL user and corresponding password for use. <br />
Storing the MySQL username and password in secret.txt in Project_dir with following format: <br />
```
username:<your_username>
password:<your_password>
```
Then you can import permission.sql into MySQL with unique account. <br />

#### Running the program:
====================

At Project_dir, just type ./pdaemon, then the program will run as a daemon. <br />
Now, you can upload your Android Apps to Project_dir/files to be analyzed. <br />
You can get the result from Project_dir/files/result.txt and/or <br />
corresponding report files in Project_dir/files/REPORT. <br />

To stop the program, you just need to type ./stop.sh at Project_dir. <br />
You can check whether the program is running or stoped by pdaemon.log in Project_dir/log. <br />

#### Program functions and files introduction:
==============================

- Project_dir
   - pdaemon.c <br />
        pdaemon.c is the source file of main program pdaemon. <br />
    <br />
   - pdaemon.lock <br />
        pdaemon.lock records the pid of pdaemon when pdaemon is running. <br />
    <br />
   - pdaemon <br />
        pdaemon is the main program. It sequentailly calls other functions in Project_dir/bin <br />
        so that the daemon can perform Android App Analysis automatically. <br />
        It outputs log in pdaemon.log in Project_dir/log. <br />
    <br />
   - stop.sh <br />
        It reads the value in pdaemon.lock so that it can stop the main program when user execute it. <br />
    <br />
   - condCode.txt <br />
        It records the relation between numbers and conditions. <br />
        Users can recognize the second value of each line in result.txt in Project_dir/files with condCode.txt. <br />
    <br />
- Project_dir/bin
   - unzip.pl <br />
        It unzips apk files into corresponding directory. <br />
    <br />
   - toSmali.pl <br />
        It converts class.dex in each apk directory into *.smali using baksmali.jar. <br />
    <br />
   - baksmali.jar <br />
        It is a disasembler for Android's dex format built by others. <br />
        Project Home: http://code.google.com/p/smali/ <br />
    <br />
   - toBasicBlock.pl <br />
        It reads *.smali of each apk, then storing useful information in corresponding .bb file in Project_dir/files/BB. <br />
    <br />
   - featureHash.pl <br />
        It generates feature hash value of each apk by reading corresponding bb file. <br />
        Then it stores the values in FHTemp.txt in Project_dir/files/FH. <br />
    <br />
   - distance.pl <br />
        It calcuates the similarity between the feature hash values using Jaccard Similarity. <br />
        If there is no feature hash value that has high similarity with it, then the App will left for taint analysis. <br />
    <br />
   - mainDetect.pl <br />
        It converts each class.dex in each apk that previously similairty tested but left for taint analysis into <br />
        corresponding .jar using dex2jar. Then calling CallGraphAnalysis.pl and passing values to it for further analysis. <br />
    <br />
   - dex2jar <br />
        It is a tool that work with Android .dex and JAVA .class files built by others. <br />
        Project Home: http://code.google.com/p/dex2jar/ <br />
    <br />
   - CallGraphAnalysis.pl <br />
        It uses function call graph information of the Android App generated by javacg-static.jar and <br />
        Android API information storing in permission database to perform taint analysis. <br />
        It would check whether the Android App has privacy data leak, then stores the result in corresponding report file <br />
        in Project_dir/files/REPORT. <br />
    <br />
   - javacg-static.jar <br />
        It is a subprogram of java-callgraph. It is used to produce static call graph for JAVA programs. <br />
        And it is built by others. <br />
        Project Home: https://github.com/gousiosg/java-callgraph <br />

#### Author
======

Po-Wei Chen <erase2004@gmail.com>
...
